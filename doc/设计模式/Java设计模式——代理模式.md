# Java设计模式——代理模式

## 1.代理模式

​		给某一个对象提供一个代理或者占位符，并由代理对象控制对源对象进行访问。

​		适配器是一种特殊的代理模式。

​		外观模式和代理模式的区别：

- 通常情况下，外观模式是需要调用多个不同的子对象去实现对应的功能，而代理模式只针对一个对象
- 核心的区别在于，外观模式只是业务组合的外观，提供一个功能的接口以供调用，本身没有业务操作；代理对象不仅仅满足代理对应的对象，还具有自己的业务操作，通过附加的业务操作与代理对象的功能实现一个完整的功能。比如教师通知同学去开会，教师让班长通知同学开会，班长自己去通知每个同学，这是外观模式；班长记录开会安排，再去通知每一个同学去开会，这是代理模式。

​		主要角色：

​		1）Subject(抽象主题角色)：声明真是主题于代理主题的共同接口，客户端针对出现主题角色进行编程。

​		2）Proxy(代理主题角色)：具有具体主体类的引用，继承与实现抽象代理角色的功能接口。代理主体角色可以使用具体主体对象

​		3）RealSubject(具体主体角色)：定义代理对象所代表的真实对象，继承与实现抽象主题的功能方法。

![ ](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210908112239970.png)

​		代理模式就相当于是求人委托办事，为了达到一个目的比如买手机，你可以自己去找手机厂商（RealSubject）去买对应的手机，但是这样太麻烦，而且要是我想要其他完全不同类东西，又得去找其他的厂商(RealSubject)，缺少灵活性。因此我们引入一个代理商(Proxy)，让代理商拿着我的购买目标去购买对应的产品，我只需要告诉他我需要什么（调用对应的功能业务方法），代理商就会讲对应的商品给我，而代理商因为有我需要的所有厂商的联系方式（RealSubject对象成员），就可以与他联系（调用RealSubject成员的方法）获得对应的商品（输出结果）。于是同样是买东西，我只要和一个人（Subject,实例化Proxy,多态）说清楚就可以获得多个厂商的商品。

## 2.远程代理

​		为一个位于不同地址空间的对象提供一个本地代理对象，这个不同的地址空间可以在同一台主机中，也可以在另一台主机中，远程代理又被称为大使。充当着在不同位置具有相同职能的作用，类似于我们国家在各个国家的大使馆，虽然大使馆不在我们国家，但是他充当着国家的作用，用于代表我们国家与其他国家进行交流。

## 3.虚拟代理

​		如果创建一个资源消耗较大的对象，先创建一个消耗相对较小的对象来表示，真实对象只在需要时才会被真正创建。就好比我们生活中的要想制造一个大型的器件，首先需要创建一个简单的可以让用户看懂的样品，样品的制作往往会需要较便宜或者较为简便的材料进行组合。只有当真正确定下来后，工厂才会根据样品的基本特征，将样品打造成实际能使用的产品。操作系统的应用程序图标就是虚拟代理，相册的预览图的展示也是虚拟代理。只有点击进去以后才能展现具体内容

## 4.保护代理

​		公布代理对象，进行权限控制。让代理类去进行权限校验。

## 5.缓冲代理

​		查询数据时提供一个临时存储空间，先在临时存储空间中查询，随后再到服务器中进行查询，降低主服务器的压力。比如反向代理服务器，就是具有这样的缓冲区

## 6.智能引用代理

​		当一个对象被引用时，提供一个额外的操作，比如记录日志。

## 7.动态代理

​		让系统运行时根据实际需要来动态创建代理类，一个代理类能够代理多个不同的真实主题类而且可以带你不同的方法。他在事务管理、AOP（Aspect-Oriented Programming,面向方面编程）

​		**Proxy类**——用于创建动态代理类和实例对象

​		InvocationHandler接口——代理处理程序类的实现接口，该接口作为代理实例的调用处理者的公共父类，每一个代理类的实例都可以提供一个相关的具体调用处理者（InvocationHandler的子类）。该接口声明了如下方法

```java
/**
*@Param proxy 代理类的实例
*@Param method 需要代理的方法
*@Param args 代理方法的参数数组，无参函数传入null
**/
public Object invoke(Object proxy,Method method,Object[] args)
```

​		

## 8.代理模式的特点

**1.优点**

​	①**能够协调调用者和被调用者，在一定程度上降低了系统的耦合度**，无需直接调用

​	②**客户端可以针对抽象主题角色进行编程，增加和更换代理类无须修改源代码，符合开闭原则，系统具有较好的灵活性和可扩展性**

**2.逐个分析**

​		①**远程代理：可以将一些消耗资源较多的对象和操作移至性能更好的计算机上，提高了系统的整体运行效率**

​		②**虚拟代理：通过一个消耗资源较少的对象来代表一个消耗资源较多的对象，可以在一定程度上节省系统的运行开销**

​		③**缓冲代理：为某一个操作的结果提供临时的缓存存储空间，以便在后续使用中能够共享这些结果，优化系统性能，缩短执行时间**

​		④**保护代理：可以控制对一个对象的访问权限，为不同用户提供不同级别的使用权限，会导致调用对应接口的执行时间变长**

3.**缺点**

​		①**由于在客户端和真实主题之间增加了代理对象，因此有些类型的代理模式可能会造成请求的处理速度变慢（例如保护代理）**

​		②**实现代理模式需要额外的工作，而且有些代理模式的实现过程较为复杂（例如远程代理）**

4.使用环境：
		①当客户端对象需要访问远程主机中的对象时可以使用远程代理
		②当需要用一个消耗资源较少的对象来代表一个消耗资源较多的对象，从而降低系统开销、缩短运行时间时可以使用虚拟代理
		③当需要为某一个被频繁访问的操作结果提供一个临时存储空间，以供多个客户端共享访问这些结果时可以使用缓冲代理	
		④当需要控制对一个对象的访问，为不同用户提供不同级别的访问权限时可以使用保护代理
		⑤当需要为一个对象的访问（引用）提供一些额外的操作时可以使用智能引用代理